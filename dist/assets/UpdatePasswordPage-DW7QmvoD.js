import{j as e}from"./radix-ui-BdNglvg2.js";import{N as A}from"./NarrowCol-DUq-L8Qp.js";import{A as j,a as w,C as u,b as z,c as v,d as I,e as x,h as y,I as N,B as R,u as U,s as V}from"./index-BVuyqb0h.js";import{I as E,e as H,X as L,aE as q,ai as C,aC as P,a6 as k,a7 as T}from"./ui-utils-CHvRCCKz.js";import{e as S,R as c}from"./react-vendor-nLIND2rL.js";import"./refine-core-BpFEoGih.js";import"./utils-C8X7R3D6.js";import"./refine-ui-D3vAG_bA.js";import"./forms-aDucxvuO.js";import"./tables-B_D9J81n.js";const m=({children:s})=>e.jsx(A,{children:s}),B=(s,a)=>s?s.length<6?"Hasło musi mieć co najmniej 6 znaków":s.length>72?"Hasło nie może być dłuższe niż 72 znaki":s!==a?"Hasła nie są identyczne":null:"Hasło jest wymagane",F=()=>[{text:"Minimum 6 znaków",check:s=>s.length>=6},{text:"Maksimum 72 znaki",check:s=>s.length<=72},{text:"Zawiera małą literę",check:s=>/[a-z]/.test(s)},{text:"Zawiera dużą literę",check:s=>/[A-Z]/.test(s)},{text:"Zawiera cyfrę",check:s=>/[0-9]/.test(s)},{text:"Zawiera znak specjalny",check:s=>/[^a-zA-Z0-9]/.test(s)}],M=({password:s})=>{const a=F();return e.jsxs(j,{children:[e.jsx(E,{className:"h-4 w-4"}),e.jsxs(w,{children:[e.jsx("strong",{children:"Wymagania hasła:"}),e.jsx("ul",{className:"mt-2 space-y-1",children:a.map((r,n)=>{const t=s?r.check(s):!1,i=n<2;return e.jsxs("li",{className:`flex items-center text-sm ${t?"text-green-700":i?"text-red-600":"text-gray-600"}`,children:[t?e.jsx(H,{className:"h-3 w-3 mr-1"}):e.jsx(L,{className:"h-3 w-3 mr-1"}),r.text,i&&" (wymagane)"]},n)})})]})]})},W=({password:s,confirmPassword:a,setPassword:r,setConfirmPassword:n,isLoading:t,error:i,handleSubmit:o})=>e.jsxs(u,{children:[e.jsxs(z,{className:"space-y-1",children:[e.jsxs(v,{className:"text-2xl text-center flex items-center justify-center gap-2",children:[e.jsx(q,{className:"h-6 w-6"}),"Nowe hasło"]}),e.jsx(I,{className:"text-center",children:"Wprowadź nowe hasło dla swojego konta"})]}),e.jsxs(x,{children:[e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"password",children:"Nowe hasło"}),e.jsx(N,{id:"password",type:"password",placeholder:"Minimum 6 znaków",value:s,onChange:l=>r(l.target.value),disabled:t,required:!0,autoFocus:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"confirmPassword",children:"Potwierdź nowe hasło"}),e.jsx(N,{id:"confirmPassword",type:"password",placeholder:"Powtórz nowe hasło",value:a,onChange:l=>n(l.target.value),disabled:t,required:!0})]}),e.jsx(M,{password:s}),i&&e.jsxs(j,{variant:"destructive",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(w,{children:i})]}),e.jsxs(R,{type:"submit",className:"w-full",disabled:t,children:[t&&e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}),t?"Aktualizowanie...":"Zaktualizuj hasło"]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Pamiętasz hasło?"," ",e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-500",children:"Wróć do logowania"})]})})]})]}),b=({isChecking:s,isValid:a,error:r})=>s?e.jsx(u,{children:e.jsx(x,{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Weryfikacja sesji..."})]})})}):a?null:e.jsx(u,{className:"border-red-200",children:e.jsx(x,{className:"pt-6",children:e.jsxs(j,{variant:"destructive",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsxs(w,{children:[e.jsx("strong",{children:"Nieprawidłowa lub wygasła sesja."}),e.jsx("br",{}),r||"Link do resetowania hasła mógł wygasnąć.",e.jsx("br",{}),e.jsx("span",{className:"text-sm",children:"Za chwilę zostaniesz przekierowany..."})]})]})})}),D=()=>e.jsxs(u,{className:"border-green-200",children:[e.jsx(z,{children:e.jsxs(v,{className:"text-2xl text-center flex items-center justify-center gap-2",children:[e.jsx(k,{className:"h-6 w-6 text-green-600"}),"Hasło zmienione!"]})}),e.jsxs(x,{children:[e.jsxs(j,{className:"border-green-200 bg-green-50",children:[e.jsx(k,{className:"h-4 w-4 text-green-600"}),e.jsxs(w,{className:"text-green-800",children:["Twoje hasło zostało pomyślnie zmienione.",e.jsx("br",{}),"Za chwilę zostaniesz przekierowany do strony logowania..."]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("a",{href:"/login",className:"text-blue-600 hover:text-blue-500 inline-flex items-center",children:["Przejdź do logowania",e.jsx(T,{className:"ml-2 h-4 w-4"})]})})]})]}),K=()=>{const s=S(),[a,r]=c.useState(""),[n,t]=c.useState(""),[i,o]=c.useState(null),[l,d]=c.useState(!1),[p,h]=c.useState(!1);return{password:a,confirmPassword:n,setPassword:r,setConfirmPassword:t,isLoading:p,error:i,isSuccess:l,handleSubmit:async Z=>{Z.preventDefault(),o(null);const g=B(a,n);if(g){o(g);return}h(!0);const f=await U.updatePassword(a);h(!1),f.success?(d(!0),setTimeout(()=>s("/login?passwordChanged=true"),3e3)):o(f.error)}}},X=()=>{const s=S(),[a,r]=c.useState(!0),[n,t]=c.useState(!1),[i,o]=c.useState();return c.useEffect(()=>{(async()=>{try{const{data:d}=await V.auth.getSession(),h=new URLSearchParams(window.location.hash.substring(1)).get("type");!d.session&&h!=="recovery"?(t(!1),o("Link wygasł lub jest nieprawidłowy"),setTimeout(()=>s("/forgot-password"),3e3)):t(!0)}catch{t(!1),o("Błąd weryfikacji sesji")}finally{r(!1)}})()},[s]),{isChecking:a,isValid:n,error:i}},re=()=>{const s=X(),a=K();return s.isChecking?e.jsx(m,{children:e.jsx(b,{isChecking:!0})}):s.isValid?a.isSuccess?e.jsx(m,{children:e.jsx(D,{})}):e.jsx(m,{children:e.jsx(W,{...a})}):e.jsx(m,{children:e.jsx(b,{isChecking:!1,isValid:!1,error:s.error})})};export{re as default};
